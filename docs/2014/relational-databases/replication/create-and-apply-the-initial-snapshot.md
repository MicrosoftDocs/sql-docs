---
title: "Create and Apply the Initial Snapshot | Microsoft Docs"
ms.custom: ""
ms.date: "06/13/2017"
ms.prod: "sql-server-2014"
ms.reviewer: ""
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords: 
  - "snapshots [SQL Server replication], creating"
  - "snapshot replication [SQL Server], initial snapshots"
ms.assetid: 742727a1-5189-44ec-b3ae-6fd7aa1f5347
author: MashaMSFT
ms.author: mathoma
manager: craigg
---
# Create and Apply the Initial Snapshot
  This topic describes how to create and apply the initial snapshot in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], [!INCLUDE[tsql](../../includes/tsql-md.md)], or Replication Management Objects (RMO). Merge publications that use parameterized filters require a two-part snapshot. For more information, see [Create a Snapshot for a Merge Publication with Parameterized Filters](create-a-snapshot-for-a-merge-publication-with-parameterized-filters.md).  
  
 **In This Topic**  
  
-   **To create and apply the initial snapshot, using:**  
  
     [SQL Server Management Studio](#SSMSProcedure)  
  
     [Transact-SQL](#TsqlProcedure)  
  
     [Replication Management Objects (RMO)](#RMOProcedure)  
  
##  <a name="SSMSProcedure"></a> Using SQL Server Management Studio  
 By default, if [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent is running, a snapshot is generated by the Snapshot Agent immediately after a publication is created with the New Publication Wizard. By default, it is then applied by the Distribution Agent (for snapshot and transactional replication) or Merge Agent (for merge subscriptions) for all subscriptions. A snapshot can also be generated using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] and Replication Monitor. For information about starting Replication Monitor, see [Start the Replication Monitor](monitor/start-the-replication-monitor.md).  
  
#### To create a snapshot in Management Studio  
  
1.  Connect to the Publisher in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)], and then expand the server node.  
  
2.  Expand the **Replication** folder, and then expand the **Local Publications** folder.  
  
3.  Right-click the publication for which you want to create a snapshot, and then click **View Snapshot Agent Status**.  
  
4.  In the **View Snapshot Agent Status - \<Publication>** dialog box, click **Start**.  
  
 When the Snapshot Agent finishes generating the snapshot, a message will be displayed, such as "[100%] A snapshot of 17 article(s) was generated."  
  
#### To create a snapshot in Replication Monitor  
  
1.  In Replication Monitor, expand a Publisher group in the left pane, and then expand a Publisher.  
  
2.  Right-click the publication for which you want to generate a snapshot, and then click **Generate Snapshot**.  
  
3.  To view the status of the Snapshot Agent, click the **Agents** tab. For more detailed information, right-click the Snapshot Agent in the grid, and then click **View Details**.  
  
#### To apply a snapshot  
  
1.  After the snapshot is generated, it is applied by synchronizing the subscription with the Distribution Agent or the Merge Agent:  
  
    -   If the agent is set to run continuously (the default for transactional replication), the snapshot is automatically applied after it is generated.  
  
    -   If the agent is set to run on a schedule, the snapshot is applied the next time the agent is scheduled to run.  
  
    -   If the agent is set to run on demand, it is applied the next time you run the agent.  
  
     For more information about synchronizing subscriptions, see [Synchronize a Push Subscription](synchronize-a-push-subscription.md) and [Synchronize a Pull Subscription](synchronize-a-pull-subscription.md).  
  
##  <a name="TsqlProcedure"></a> Using Transact-SQL  
 Initial snapshots can be programmatically created either by creating and running a Snapshot Agent job or by running the Snapshot Agent executable file from a batch file. After an initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized. If you run the Snapshot Agent from a command prompt or a batch file, you will need to rerun the agent whenever the existing snapshot becomes invalid.  
  
> [!IMPORTANT]  
>  When possible, prompt users to enter security credentials at runtime. If you must store credentials in a script file, you must secure the file to prevent unauthorized access.  
  
#### To create and run a Snapshot Agent job to generate the initial snapshot  
  
1.  Create a snapshot, transactional, or merge publication. For more information, see [Create a Publication](publish/create-a-publication.md).  
  
2.  Execute [sp_addpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-addpublication-snapshot-transact-sql). Specify **@publication** and the following parameters:  
  
    -   **The @job_login, which specifies** the Windows Authentication credentials under which the Snapshot Agent runs at the Distributor.  
  
    -   **The @job_password**, which is the password for the supplied Windows credentials.  
  
    -   (Optional) A value of **0** for **@publisher_security_mode** if the agent will use SQL Server Authentication when connecting to the Publisher. In this case, you must also specify the SQL Server Authentication login information for **@publisher_login** and **@publisher_password**.  
  
    -   (Optional) A synchronization schedule for the Snapshot Agent job. For more information, see [Specify Synchronization Schedules](specify-synchronization-schedules.md).  
  
    > [!IMPORTANT]  
    >  When configuring a Publisher with a remote Distributor, the values supplied for all parameters, including *job_login* and *job_password*, are sent to the Distributor as plain text. You should encrypt the connection between the Publisher and its remote Distributor before executing this stored procedure. For more information, see [Enable Encrypted Connections to the Database Engine &#40;SQL Server Configuration Manager&#41;](../../database-engine/configure-windows/enable-encrypted-connections-to-the-database-engine.md).  
  
3.  Add articles to the publication. For more information, see [Define an Article](publish/define-an-article.md).  
  
4.  At the Publisher on the publication database, execute [sp_startpublication_snapshot &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-startpublication-snapshot-transact-sql), specifying the value of **@publication** from step 1.  
  
#### To run the Snapshot Agent to generate the initial snapshot  
  
1.  Create a snapshot, transactional, or merge publication. For more information, see [Create a Publication](publish/create-a-publication.md).  
  
2.  Add articles to the publication. For more information, see [Define an Article](publish/define-an-article.md).  
  
3.  From the command prompt or in a batch file, start the [Replication Snapshot Agent](agents/replication-snapshot-agent.md) by running **snapshot.exe**, specifying the following command-line arguments:  
  
    -   **-Publication**  
  
    -   **-Publisher**  
  
    -   **-Distributor**  
  
    -   **-PublisherDB**  
  
    -   **-ReplicationType**  
  
     If you are using SQL Server Authentication, you must also specify the following arguments:  
  
    -   **-DistributorLogin**  
  
    -   **-DistributorPassword**  
  
    -   **-DistributorSecurityMode** = **0**  
  
    -   **-PublisherLogin**  
  
    -   **-PublisherPassword**  
  
    -   **-PublisherSecurityMode** = **0**  
  
###  <a name="TsqlExample"></a> Examples (Transact-SQL)  
 This example shows how to create a transactional publication and add a Snapshot Agent job for the new publication (using **sqlcmd** scripting variables). The example also starts the job.  
  
 [!code-sql[HowTo#sp_trangenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createtranpubinitialsnapshot.sql#sp_trangenerate_snapshot)]  
  
 This example creates a merge publication and adds a Snapshot Agent job (using **sqlcmd** variables) for the publication. This example also starts the job.  
  
 [!code-sql[HowTo#sp_mergegenerate_snapshot](../../snippets/tsql/SQL15/replication/howto/tsql/createmergepubinitialsnapshot.sql#sp_mergegenerate_snapshot)]  
  
 The following command-line arguments start the Snapshot Agent to generate the snapshot for a merge publication.  
  
> [!NOTE]  
>  Line breaks were added to improve readability. In a batch file, commands must be made in a single line.  
  
 [!code-sql[HowTo#startmergesnapshot_10](../../snippets/tsql/SQL15/replication/howto/tsql/createmergesnapshot_10.bat)]  
  
##  <a name="RMOProcedure"></a> Using Replication Management Objects (RMO)  
 The Snapshot Agent generates snapshots after a publication is created. You can generate these snapshots programmatically by using Replication Management Objects (RMO) and direct managed code access to replication agent functionalities. The objects you use depend on the type of replication. The Snapshot Agent can be started synchronously using the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> object or asynchronously using the agent job. After the initial snapshot has been generated, it is transferred to and applied at the Subscriber when the subscription is first synchronized. You will need to rerun the agent whenever the existing snapshot no longer contains valid, up-to-date data. For more information, see [Maintain Publications](publish/maintain-publications.md).  
  
> [!IMPORTANT]  
>  When possible, prompt users to enter security credentials at runtime. If you must store credentials, use the [cryptographic services](https://go.microsoft.com/fwlink/?LinkId=34733) provided by the [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows .NET Framework.  
  
#### To generate the initial snapshot for a snapshot or transactional publication by starting the Snapshot Agent job (asynchronous)  
  
1.  Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.  
  
2.  Create an instance of the <xref:Microsoft.SqlServer.Replication.TransPublication> class. Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.  
  
3.  Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object. If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.  
  
4.  If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.  
  
5.  Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.  
  
6.  (Optional) When the value of <xref:Microsoft.SqlServer.Replication.TransPublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.  
  
#### To generate the initial snapshot for a snapshot or transactional publication by running the Snapshot Agent (synchronous)  
  
1.  Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher. Windows Authentication is recommended.  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor. Windows Authentication is recommended.  
  
2.  Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Transactional> or <xref:Microsoft.SqlServer.Replication.ReplicationType.Snapshot> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.  
  
3.  Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.  
  
#### To generate the initial snapshot for a merge publication by starting the Snapshot Agent job (asynchronous)  
  
1.  Create a connection to the Publisher by using the <xref:Microsoft.SqlServer.Management.Common.ServerConnection> class.  
  
2.  Create an instance of the <xref:Microsoft.SqlServer.Replication.MergePublication> class. Set the <xref:Microsoft.SqlServer.Replication.Publication.Name%2A> and <xref:Microsoft.SqlServer.Replication.Publication.DatabaseName%2A> properties for the publication, and set the <xref:Microsoft.SqlServer.Replication.ReplicationObject.ConnectionContext%2A> property to the connection created in step 1.  
  
3.  Call the <xref:Microsoft.SqlServer.Replication.ReplicationObject.LoadProperties%2A> method to load the remaining properties of the object. If this method returns `false`, either the publication properties in step 2 were defined incorrectly or the publication does not exist.  
  
4.  If the value of <xref:Microsoft.SqlServer.Replication.Publication.SnapshotAgentExists%2A> is `false`, call <xref:Microsoft.SqlServer.Replication.Publication.CreateSnapshotAgent%2A> to create the snapshot agent job for this publication.  
  
5.  Call the <xref:Microsoft.SqlServer.Replication.Publication.StartSnapshotGenerationAgentJob%2A> method to start the agent job that generates the snapshot for this publication.  
  
6.  (Optional) When the value of <xref:Microsoft.SqlServer.Replication.MergePublication.SnapshotAvailable%2A> is `true`, the snapshot is available to Subscribers.  
  
#### To generate the initial snapshot for a merge publication by running the Snapshot Agent (synchronous)  
  
1.  Create an instance of the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent> class, and set the following required properties:  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publisher%2A> - name of the Publisher  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherDatabase%2A> - name of the publication database  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Publication%2A> - name of the publication  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.Distributor%2A> - name of the Distributor  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Publisher or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.PublisherPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Publisher. Windows Authentication is recommended.  
  
    -   <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorSecurityMode%2A> - a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Integrated> to use Windows Authentication when connecting to the Distributor or a value of <xref:Microsoft.SqlServer.Replication.SecurityMode.Standard> and values for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorLogin%2A> and <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.DistributorPassword%2A> to use [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Authentication when connecting to the Distributor. Windows Authentication is recommended.  
  
2.  Set a value of <xref:Microsoft.SqlServer.Replication.ReplicationType.Merge> for <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.ReplicationType%2A>.  
  
3.  Call the <xref:Microsoft.SqlServer.Replication.SnapshotGenerationAgent.GenerateSnapshot%2A> method.  
  
###  <a name="PShellExample"></a> Examples (RMO)  
 This example synchronously runs the Snapshot Agent to generate the initial snapshot for a transactional publication.  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot)]  
  
 This example asynchronously starts the agent job to generate the initial snapshot for a transactional publication.  
  
 [!code-csharp[HowTo#rmo_GenerateSnapshot_WithJob](../../snippets/csharp/SQL15/replication/howto/cs/rmotestevelope.cs#rmo_generatesnapshot_withjob)]  
  
 [!code-vb[HowTo#rmo_vb_GenerateSnapshot_WithJob](../../snippets/visualbasic/SQL15/replication/howto/vb/rmotestenv.vb#rmo_vb_generatesnapshot_withjob)]  
  
## See Also  
 [Create a Publication](publish/create-a-publication.md)   
 [Create a Pull Subscription](create-a-pull-subscription.md)   
 [Create a Push Subscription](create-a-push-subscription.md)   
 [Specify Synchronization Schedules](specify-synchronization-schedules.md)   
 [Create and Apply the Snapshot](create-and-apply-the-snapshot.md)   
 [Initialize a Subscription with a Snapshot](initialize-a-subscription-with-a-snapshot.md)   
 [Replication Management Objects Concepts](concepts/replication-management-objects-concepts.md)   
 [Replication Security Best Practices](security/replication-security-best-practices.md)   
 [Replication System Stored Procedures Concepts](concepts/replication-system-stored-procedures-concepts.md)   
 [Use sqlcmd with Scripting Variables](../scripting/sqlcmd-use-with-scripting-variables.md)  
  
  
